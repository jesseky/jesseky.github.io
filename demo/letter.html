<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Letter On Picture</title>
    <style type="text/css">
        html,
        body,
        section,
        article,
        section,
        div,
        aside,
        picture,
        input,
        textarea,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0;
            padding: 0;
        }

        html,
        body,
        .main,
        .article,
        .aside {
            height: 100%;
        }

        html {
            background: #F2F2F2;
        }

        i,
        b,
        var {
            font-style: normal;
            font-weight: normal;
        }

        .main {
            display: flex;
            flex-flow: row nowrap;
            justify-content: center;
            width: 100%;
            overflow: hidden;
        }

        .article {
            flex: 1;
        }

        .resolution {
            border: 1px solid #CCC;
            position: absolute;
            left: 1px;
            bottom: 1px;
            color: #AAA;
            padding: 0 2px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .aside {
            width: 320px;
            border-left: 1px solid #CCC;
            padding: 0 5px;
        }

        .txt,
        .txa {
            line-height: 24px;
            font-size: 16px;
            display: block;
            box-sizing: border-box;
            -webkit-appearance: none;
            outline: none;
            border: 1px solid #CCC;
            padding: 0 3px;
        }

        .txt,
        .sel {
            width: 40%;
        }

        .txs {
            width: 20%;
        }

        .txa-letter {
            min-height: 240px;
            width: 100%;
            margin: 22px 0;
            height: calc(100vh - 350px);
        }

        .txt:focus,
        .txa:focus {
            color: #20a0ff;
            border-color: #66AFE9;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.075) inset, 0 0 5px rgba(102, 175, 233, 0.6) inset;
            outline: 0px none;
        }

        .txa-letter-err,
        .txa-letter-err:focus {
            color: #CC0000;
        }

        .filewp {
            margin: 10px 0 0 0;
            display: flex;
        }

        .file {
            flex: 1;
            width: 200px;
            background: #DCDCDC;
        }

        .filewp .btn {
            padding: 0 10px;
            margin-left: 5px;
            width: 50px;
        }

        .controls {
            display: flex;
            position: relative;
            flex-flow: row nowrap;
            justify-content: space-between;
            margin-top: 15px;
        }

        label {
            width: 15%;
        }

        .controls label:not(:first-child) {
            text-align: right;
        }

        .controls b {
            position: absolute;
            top: 2px;
            right: 1em;
            color: #AAA;
        }

        h1 {
            font-size: 20px;
            line-height: 2em;
            text-align: center;
            border-bottom: 1px solid #CCC;
        }

        article {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .picture {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 75vh;
            height: 100vh;
            max-width: 98vw;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .picture canvas {
            background: #FFF;
            background: -webkit-linear-gradient(45deg, rgba(0, 0, 0, 0.0980392) 25%, rgba(0, 0, 0, 0) 25%, rgba(0, 0, 0, 0) 75%, rgba(0, 0, 0, 0.0980392) 75%, rgba(0, 0, 0, 0.0980392) 0), -webkit-linear-gradient(45deg, rgba(0, 0, 0, 0.0980392) 25%, rgba(0, 0, 0, 0) 25%, rgba(0, 0, 0, 0) 75%, rgba(0, 0, 0, 0.0980392) 75%, rgba(0, 0, 0, 0.0980392) 0), rgb(255, 255, 255);
            background: -moz-linear-gradient(45deg, rgba(0, 0, 0, 0.0980392) 25%, rgba(0, 0, 0, 0) 25%, rgba(0, 0, 0, 0) 75%, rgba(0, 0, 0, 0.0980392) 75%, rgba(0, 0, 0, 0.0980392) 0), -moz-linear-gradient(45deg, rgba(0, 0, 0, 0.0980392) 25%, rgba(0, 0, 0, 0) 25%, rgba(0, 0, 0, 0) 75%, rgba(0, 0, 0, 0.0980392) 75%, rgba(0, 0, 0, 0.0980392) 0), rgb(255, 255, 255);
            background: linear-gradient(45deg, rgba(0, 0, 0, 0.0980392) 25%, rgba(0, 0, 0, 0) 25%, rgba(0, 0, 0, 0) 75%, rgba(0, 0, 0, 0.0980392) 75%, rgba(0, 0, 0, 0.0980392) 0), linear-gradient(45deg, rgba(0, 0, 0, 0.0980392) 25%, rgba(0, 0, 0, 0) 25%, rgba(0, 0, 0, 0) 75%, rgba(0, 0, 0, 0.0980392) 75%, rgba(0, 0, 0, 0.0980392) 0), rgb(255, 255, 255);
            background-repeat: repeat, repeat;
            background-position: 0 0, 40px 40px;
            -webkit-background-origin: padding-box, padding-box;
            background-origin: padding-box, padding-box;
            -webkit-background-clip: border-box, border-box;
            background-clip: border-box, border-box;
            -webkit-background-size: 80px 80px, 80px 80px;
            background-size: 80px 80px, 80px 80px;
        }

        .drop-in {
            background: #66AFE9;
        }

        .btn {
            font: inherit;
            width: 100%;
            border-radius: 3px;
            border: 1px solid #B1B1B1;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.05);
            line-height: 1.5em;
            margin: 0;
            padding: 5px 10px;
            background-color: #eee;
            background-image: linear-gradient(#FCFCFC, #EEE);
            -webkit-apparence: none;
        }

        .btn:hover {
            border-color: #CCC;
            background-color: #DDD;
            background-image: linear-gradient(#EEE, #DDD);
        }

        .btn:focus,
        .btn:active {
            outline: 0;
            border-color: #51A7E8;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .btn[disabled],
        .btn[disabled]:hover,
        .btn[disabled]:active {
            color: rgba(102, 102, 102, 0.5);
            background-image: none;
            background-color: #EEE;
            box-shadow: none;
            border: 1px solid #D5D5D5;
            cursor: not-allowed;
        }

        .menu {
            display: none;
            position: absolute;
            left: 0;
            top: 0;
            z-index: 9;
            font-size: 40px;
            line-height: 40px;
            height: 40px;
        }

        .menu-on {
            color: #20a0ff;
        }

        select {
            border: 1px solid #CCC;
            height: 24px;
            border-radius: 0px;
            padding: 0 5px;
        }

        .note {
            position: absolute;
            left: 0;
            top: 0;
            background: #000;
            background: rgba(0, 0, 0, 0.5);
            color: #09f909;
            width: 100%;
            z-index: 2;
            transition: all 0.3s ease-in-out;
        }

        .note-btn {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            display: flex;
            flex-flow: row-reverse;
            align-items: center;
            z-index: 3;
        }

        .note-text {
            padding: 10px;
        }

        .note-hide {
            top: -500px;
        }

        .colors-lbl {
            position: relative;
        }

        .colors-pan {
            position: absolute;
            z-index: 3;
            background: #FFF;
            border: 1px solid #CCC;
            width: 300px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-flow: row;
            flex-wrap: wrap;
            font-size: 12px;
            box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.1);
        }

        .colors-pan-hide {
            display: none;
        }

        .colors-pan h3 {
            width: 100%;
            line-height: 1.5em;
            font-size: 16px;
        }

        .colors-pan a {
            width: 60px;
            color: #FFF;
            text-decoration: none;
        }

        .colors-pan a i,
        .colors-pan a var {
            display: block;
        }

        .colors-pan a.on {
            position: relative;
            box-shadow: 0 0 10px inset;
        }

        .colors-pan a.on::before {
            display: block;
            width: 12px;
            height: 12px;
            border: 1px solid;
            border-radius: 100%;
            content: '';
            position: absolute;
            right: 0;
            top: 0;
        }

        .result-btns {
            display: flex;
            flex-flow: row;
            justify-content: space-between;
        }

        .result-btns button {
            width: 48%;
        }

        .showmsg {
            position: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            top: -160px;
            left: 0;
            left: calc(50% - 200px);
            width: 400px;
            height: 120px;
            background: rgba(0, 0, 0, 0.8);
            transition: all 0.5s ease-in-out;
        }

        .showmsg-show {
            top: 20px;
        }

        .showmsg-in {
            width: calc(100% - 10px);
            height: calc(100% - 10px);
            color: #FFF;
            display: flex;
            flex-flow: column;
            justify-content: center;
            align-items: center;
        }

        .showmsg-close {
            position: absolute;
            right: -15px;
            top: -15px;
            width: 30px;
            height: 30px;
            display: block;
            font-size: 15px;
            border-radius: 100%;
            background: #000;
            color: #FFF;
            outline: none;
            border: 0 none;
            text-align: center;
            line-height: 30px;
        }

        .txa-in-msg {
            width: 100%;
            height: 80%;
        }

        .showmsg-tip {
            color: greenyellow;
            text-align: center;
        }

        .output {
            height: 50px;
            line-height: 20px;
            color: #CC0000;
        }

        @media screen and (max-width: 1024px) {
            label {
                font-size: 12px;
            }

            .menu {
                display: block;
            }

            .showmsg {
                width: 100vw;
                left: 0;
            }

            .showmsg-close {
                right: 0px;
            }

            .colors-pan {
                padding: 5px;
            }

            .aside {
                background: rgba(255, 255, 255, 0.8);
                position: absolute;
                right: -100%;
                top: 0;
                width: 90vw;
                max-width: 320px;
                z-index: 5;
                transition: all 0.5s ease-out;
            }

            .aside-hide {
                display: none;
            }

            .txa-letter {
                margin: 10px 0;
            }
        }

        @media print {
            @page {
                margin: 0;
            }

            .menu,
            .note-btn,
            .aside-hide,
            .showmsg,
            .resolution {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div id="menu" class="menu">â˜·</div>
    <div id="showmsg" class="showmsg"><button class="showmsg-close" id="showmsg-close">X</button>
        <div id="showmsg-in" class="showmsg-in"></div>
    </div>
    <section id="main" class="main">
        <div class="note-btn"><button id="notebtn">ï¸¾</button></div>
        <div id="note" class="note note-hide">
            <div class="note-text">
                <p>è¯´æ˜ï¼š</p>
                <p>
                    å¿…é¡»æ˜¯åˆæ³•çš„jsæ•°ç»„æ ¼å¼ï¼Œæ•°ç»„ä¸­å¯ä»¥ä¸ºçº¯å­—ç¬¦ã€æˆ–å¯¹è±¡ï¼Œå¯¹è±¡æ ¼å¼å¦‚ä¸‹ï¼š
                </p>
                <p>
                    t: è¡¨ç¤ºæ–‡æœ¬ï¼ˆtext)ï¼Œ<br>
                    c: è¡¨ç¤ºé¢œè‰²(color)ï¼Œ<br>
                    s: è¡¨ç¤ºå°ºå¯¸(sizeï¼Œä¸ºæ•°å€¼ï¼Œå³å…¨å±€å­—ä½“å¤§å°çš„å€æ•°)ï¼Œ<br>
                    f: è¡¨ç¤ºå­—ä½“ (font)ï¼Œ<br>
                    fs: è¡¨ç¤ºå­—ä½“æ ·å¼ï¼ˆfontStyleï¼Œå¯ä»¥æ˜¯ï¼šboldã€itlaticã€lightç­‰å€¼)ï¼Œ<br>
                    st: (å€¼ä¸º1æ—¶å€™ï¼Œä½¿ç”¨strokeæ–¹å¼ç»˜åˆ¶æ–‡æœ¬ï¼Œå³é•‚ç©ºæ¨¡å¼)ï¼Œ<br>
                    æ¢è¡Œï¼š<br>
                    l: è¡¨ç¤ºæ¢è¡Œè¡Œé«˜(line-heightï¼Œä»…åœ¨æ–‡æœ¬éƒ½æ˜¯\nå’Œç©ºæ ¼æ—¶å€™ï¼Œç”Ÿæ•ˆï¼Œä¸€ä¸ªç©ºæ ¼é»˜è®¤ç¼©è¿›ä¸€ä¸ªå­—ç¬¦)ï¼Œ<br>
                    nc: è¡¨ç¤º\nçš„æ•°é‡(n-count)ï¼Œ<br>
                    sc: è¡¨ç¤ºç©ºæ ¼çš„æ•°é‡(space-count)
                </p>
            </div>
        </div>
        <article class="article">
            <picture class="picture" id="dropIn">
                <canvas id="canvas"></canvas>
            </picture>
            <div class="resolution" id="resolution"></div>
        </article>
        <aside class="aside aside-hide" id="aside">
            <div class="block1">
                <h1>é€‰æ‹©æ–‡ä»¶ï¼Œè¾“å…¥æ–‡å­—</h1>
                <div class="filewp"><input type="file" id="file" class="file" accept="image/*"><button id="rotate" class="btn">â†»</button></div>
                <div class="controls"><label class="lbl">å­—ä½“ï¼š</label><select id="font" class="sel">
                        <option>sans-serif</option>
                        <option>serif</option>
                        <option>monospace</option>
                    </select>
                    <label class="lbl">å¤§å°ï¼š</label><input class="txt txs" type="number" id="size" min="1" max="100" step="1" value="5"><b>%</b>
                </div>
                <div class="controls"><label class="lbl colors-lbl" id="colorlblfg">é¢œè‰²ï¼š</label><input class="txt" type="text" id="colorfg" value="#000000"><label class="lbl">æ°´å¹³ï¼š</label><input class="txt txs" type="number" id="offsetx" step="1" min="0" value="10"><b>%</b></div>
                <div class="controls"><label class="lbl colors-lbl" id="colorlblbg">èƒŒæ™¯ï¼š</label><input class="txt" type="text" id="colorbg" value=""><label class="lbl">å‚ç›´ï¼š</label><input class="txt txs" type="number" step="1" id="offsety" value="20"><b>%</b></div>
            </div>
            <textarea class="txa txa-letter" cols="50" row="10" id="letters"></textarea>
            <div class="output" id="output"></div>
            <div class="result-btns"><button class="btn" id="download">ä¸‹è½½</button> <button class="btn" id="share">åˆ†äº«</button></div>
        </aside>
    </section>

    <script type="text/javascript">
        function $id(id) {
            return document.getElementById(id);
        }

        function $q(q, parent) {
            return toArray(parent ? parent.querySelectorAll(q) : document.querySelectorAll(q));
        }

        function toArray(o) {
            var ts = Object.prototype.toString.call(o);
            return ts === "[object Array]" ? o : (ts === "[object NodeList]" ? Array.prototype.slice.call(o) : [o]);
        }

        function isArray(o) {
            return Object.prototype.toString.call(o) === "[object Array]";
        }

        if (!Array.from) {
            Array.from = function (o) {
                return Array.prototype.slice.call(o);
            };
        }

        function addEvent(obj, evts, callback) {
            evts.split(/\s+/).forEach(function (evt) {
                if (obj.addEventListener) {
                    obj.addEventListener(evt, callback);
                } else if (obj.attachEvent) {
                    obj.attachEvent('on' + evt, function (e) {
                        e = e || event;
                        callback.call(e.target || e.srcElement, e);
                    });
                } else {
                    obj['on' + evt] = callback;
                }
            });
        }

        function addEvents(els, evt, func) {
            for (var i = 0; i < els.length; i++) addEvent(els[i], evt, func);
        }

        function hasClass(obj, style) {
            return obj.className.split(/\s+/).indexOf(style) > -1;
        }

        function removeClass(obj, style) {
            obj.className = obj.className.split(/\s+/).filter(function (s) {
                return s !== style;
            }).join(' ');
        }

        function toggleClass(obj, style, isAdd) {
            toArray(obj).forEach(function (el) {
                if (el.classList) {
                    if (typeof isAdd !== 'undefined') {
                        el.classList[isAdd ? 'add' : 'remove'](style);
                    } else {
                        el.classList.toggle(style);
                    }
                } else {
                    if (typeof isAdd !== 'undefined') {
                        removeClass(el, style);
                        if (isAdd) {
                            el.className += (el.className ? ' ' : '') + style;
                        }
                    } else {
                        if (el.className.includes(style)) {
                            removeClass(el, style);
                        } else {
                            el.className += (el.className ? ' ' : '') + style;
                        }
                    }
                }
            });
        }

        function b64EncodeUnicode(str) { // æ¥è‡ª stackoverflow  https://stackoverflow.com/questions/30106476/using-javascripts-atob-to-decode-base64-doesnt-properly-decode-utf-8-strings
            // first we use encodeURIComponent to get percent-encoded UTF-8,
            // then we convert the percent encodings into raw bytes which
            // can be fed into btoa.
            return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
                function toSolidBytes(match, p1) {
                    return String.fromCharCode('0x' + p1);
                }));
        }
        function b64DecodeUnicode(str) {
            // Going backwards: from bytestream, to percent-encoding, to original string.
            return decodeURIComponent(atob(str).split('').map(function (c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
        }

        function b64SafeEncode(str) {
            return b64EncodeUnicode(str).replace(/\+/g, '-').replace(/=/g, '_');
        }

        function b64SafeDecode(str) {
            return b64DecodeUnicode(str.replace(/-/g, '+').replace(/_/g, '='));
        }

        // å¼¹å‡ºä¿¡æ¯
        function showMsg(msg, autohide) {
            $id('showmsg-in').innerHTML = msg;
            toggleClass($id('showmsg'), 'showmsg-show', true);
            if (autohide) setTimeout(function () { removeClass($id('showmsg'), 'showmsg-show') }, typeof autohide === 'number' ? autohide : 5000);
        }

        function readFile(files, context) {
            if (!files.length || ['image/png', 'image/gif', 'image/jpeg', 'image/jpg'].indexOf(files[0].type) < 0) { // [].includes()
                alert("please select one validate image");
                return;
            }
            var reader = new FileReader();
            reader.onload = function (evt) {
                var image = new Image();
                image.src = evt.target.result;
                image.onload = function () {
                    context.image = image;
                    preview(context);
                };
            };
            reader.readAsDataURL(files[0]);
        }

        function dropEvent(dropObj, callback) {
            var drop = {
                onThereDo: function (evt) {
                    evt.stopPropagation();
                    evt.preventDefault();
                    if (evt.dataTransfer.types && toArray(evt.dataTransfer.types).indexOf("Files") > -1) {
                        toggleClass(dropObj, 'drop-in', true);
                        evt.dataTransfer.dropEffect = 'copy';
                    }
                },
                onLevelDo: function (evt) {
                    evt.stopPropagation();
                    evt.preventDefault();
                    removeClass(dropObj, 'drop-in');
                },
                dragenter: function (evt) {
                    drop.onThereDo(evt);
                },
                dragover: function (evt) {
                    drop.onThereDo(evt);
                },
                dragleave: function (evt) {
                    drop.onLevelDo(evt);
                },
                droped: function (evt) {
                    drop.onLevelDo(evt);
                    if (evt.dataTransfer.files && evt.dataTransfer.files.length) {
                        callback(evt.dataTransfer.files);
                    }
                }
            };
            addEvent(dropObj, 'dragenter', function (e) {
                drop.dragenter(e);
            });
            addEvent(dropObj, 'dragleave', function (e) {
                drop.dragleave(e);
            });
            addEvent(dropObj, 'dragover', function (e) {
                drop.dragover(e);
            });
            addEvent(dropObj, 'drop', function (e) {
                drop.droped(e);
            });
        }

        function preview(context) {
            var maxWidth = $id('dropIn').clientWidth;
            var maxHeight = $id('dropIn').clientHeight;
            var dpr = Math.round(window.devicePixelRatio || 1);
            context.dpr = dpr;
            context.ratio = 1 / dpr;
            var bg = $id('colorbg').value;
            if (context.image) {
                var width = context.image.naturalWidth;
                var height = context.image.naturalHeight;
                var x = 0;
                var y = 0;
                if (context.image.rotate) {
                    x = -width / 2;
                    y = -height / 2;
                    if (context.image.rotate === 90 || context.image.rotate === 270) { // é•¿å®½è°ƒæ¢
                        width = context.image.naturalHeight;
                        height = context.image.naturalWidth;
                    }
                }
                var scale = Math.min(maxWidth / width, maxHeight / height);
                context.canvas.width = width;
                context.canvas.height = height;
                context.canvas.style.width = (width * scale) + 'px';
                context.canvas.style.height = (height * scale) + 'px';
                //context.scale(1/dpr, 1/dpr);
                context.ratio = 1 / scale;
                context.clearRect(0, 0, context.canvas.width, context.canvas.height);
                if (bg) {
                    context.fillStyle = bg;
                    context.fillRect(0, 0, context.canvas.width, context.canvas.height);
                }
                context.save();
                if (context.image.rotate) {
                    context.translate(width / 2, height / 2);
                    context.rotate(context.image.rotate * Math.PI / 180);
                }
                context.drawImage(context.image, x, y);
                context.restore();
            } else {
                context.canvas.width = maxWidth * dpr;
                context.canvas.height = maxHeight * dpr;

                context.canvas.style.width = maxWidth + 'px';
                context.canvas.style.height = maxHeight + 'px';

                context.clearRect(0, 0, context.canvas.width, context.canvas.height);
                if (bg) {
                    context.fillStyle = bg;
                    context.fillRect(0, 0, context.canvas.width, context.canvas.height);
                }
            }
            $id('resolution').innerHTML = context.canvas.width + 'x' + context.canvas.height;
            drawText(context);
        }

        var fonts = {
            "é­ç¢‘": "Weibei SC",
            "é›…ç—": "Yuppy SC",
            "åœ†ä½“": "Yuanti SC",
            "é»‘ä½“": "SimHei",
            "å‡Œæ…§ä½“": "LingWai SC",
            "ç¿©ç¿©ä½“": "HanziPen SC",
            "æ‰‹æœ­ä½“": "Hannotate SC",
            "å¨ƒå¨ƒä½“": "Wawati SC",
            "å…°äº­é»‘": "Lantinghei SC",
            "åæ–‡é»‘ä½“": "STXihei",
            "åæ–‡éš¶ä¹¦": "STLiti",
            "åæ–‡æ¥·ä½“": "STKaiti",
            "åæ–‡æ–°é­": "STXinwei",
            "åæ–‡ç¥ç€": "STHupo",
            "åæ–‡è¡Œæ¥·": "STXingkai",
            "åæ–‡å®‹ä½“": "STSong",
            "åæ–‡ä¸­å®‹": "STZhongsong",
            "åæ–‡ä»¿å®‹": "STFangsong",
            "æ–¹æ­£å°‘å„¿": "FZSEK--GBK1-0",
            "æ–¹æ­£ä»¿å®‹": "FZFSK--GBK1-0",
            "æ–¹æ­£å‡†åœ†": "FZY3K--GBK1-0",
            "æ–¹æ­£å–µå‘œ": "FZMWK--GBK1-0",
            "æ–¹æ­£åº·ä½“": "FZKANGK--GBK1-0",
            "æ–¹æ­£å½©äº‘": "FZCYK--GBK1-0",
            "æ–¹æ­£æ¥·ä½“": "FZKTK--GBK1-0",
            "æ–¹æ­£è¡Œæ¥·": "FZXKK--GBK1-0",
            "æ–¹æ­£éš¶ä¹¦": "FZLSK--GBK1-0",
            "æ–¹æ­£éš¶å˜": "FZLBK--GBK1-0",
            "æ–¹æ­£é­ç¢‘": "FZWBK--GBK1-0",
            "æ–¹æ­£ç¥ç€": "FZHPK--GBK1-0",
            "æ–¹æ­£é»„è‰": "FZHCK--GBK1-0",
            "æ–¹æ­£é»‘ä½“": "FZHTK--GBK1-0",
            "æ–¹æ­£èˆ’ä½“": "FZSTK--GBK1-0",
            "æ–¹æ­£åéš¶": "FZHLK--GBK1-0",
            "æ–¹æ­£é­ç¢‘": "FZWBK--GBK1-0",
            "æ–¹æ­£ç¥ç€": "FZHPK--GBK1-0",
            "æ–¹æ­£é»„è‰": "FZHCK--GBK1-0",
            "æ–¹æ­£é»‘ä½“": "FZHTK--GBK1-0",
            "æ–¹æ­£èˆ’ä½“": "FZSTK--GBK1-0",
            "æ–¹æ­£å§šä½“": "FZYTK--GBK1-0",
            "æ–¹æ­£ç¨šè‰º": "FZZHYK--GBK1-0",
            "æ–¹æ­£ä¸­å€©": "FZZQK--GBK1-0",
            "æ–¹æ­£å¹³å’Œ": "FZPHTK--GBK1-0",
            "æ–¹æ­£ç»¼è‰º": "FZZYK--GBK1-0",
            "æ–¹æ­£å°ç¯†ä½“": "FZXZTFW--GB1-0",
            "æ–¹æ­£è¡Œé»‘ç®€ä½“": "FZXHJW--GB1-0",
            "æ–¹æ­£å¯ä½“ç®€ä½“": "FZQTJW--GB1-0",
            "æ–¹æ­£å¡é€šç®€ä½“": "FZKATJW--GB1-0",
            "æ–¹æ­£ç¥¥éš¶ç®€ä½“": "FZXIANGLJW--GB1-0",
            "æ–¹æ­£æµè¡Œä½“ç®€ä½“": "FZLXTJW--GB1-0",
            "æ–¹æ­£æ¯¡ç¬”é»‘ç®€ä½“": "FZZBHJW--GB1-0",
            "æ–¹æ­£ç¡¬ç¬”æ¥·ä¹¦ç®€ä½“": "FZYBKSJW--GB1-0",
            "æ–¹æ­£é“ç­‹éš¶ä¹¦ç®€ä½“": "FZTJLSJW--GB1-0",
            "æ–¹æ­£ç¡¬ç¬”è¡Œä¹¦ç®€ä½“": "FZYBXSJW--GB1-0",
            "æ–¹æ­£ç˜¦é‡‘ä¹¦": "FZSJSK--GBK1-0",
            "æ–¹æ­£å¾é™è•¾": "FZJLJW--GB1-0",
            "æ–°è’‚ä¸‹åˆèŒ¶æ¡ƒå¿ƒ": "SentyTEApro"
        };

        var colors = ["è”šè“#70f3ff", "è“#44cef6", "ç¢§è“#3eede7", "çŸ³é’#1685a9", "é›é’#177cb0", "é›è“#065279", "èŠ±é’#003472", "å®è“#4b5cc4", "è“ç°è‰²#a1afc9", "è—é’#2e4e7e",
            "è—è“#3b2e7e", "é»›#4a4266", "é»›ç»¿#426666", "é»›è“#425066", "é»›ç´«#574266", "ç´«è‰²#8d4bbb", "ç´«é…±#815463", "é…±ç´«#815476", "ç´«æª€#4c221b", "ç»€é’#003371",
            "ç´«æ£ #56004f", "é’è²#801dae", "ç¾¤é’#4c8dae", "é›ªé’#b0a4e3", "ä¸é¦™è‰²#cca4e3", "è—•è‰²#edd1d8", "è—•è·è‰²#e4c6d0", "æœ±ç ‚#ff461f", "ç«çº¢#ff2d51", "æœ±è†˜#f36838",
            "å¦ƒè‰²#ed5736", "æ´‹çº¢#ff4777", "å“çº¢#f00056", "ç²‰çº¢#ffb3a7", "æ¡ƒçº¢#f47983", "æµ·æ£ çº¢#db5a6b", "æ¨±æ¡ƒè‰²#c93756", "é…¡é¢œ#f9906f", "é“¶çº¢#f05654", "å¤§çº¢#ff2121",
            "çŸ³æ¦´çº¢#f20c00", "ç»›ç´«#8c4356", "ç»¯çº¢#c83c23", "èƒ­è„‚#9d2933", "æœ±çº¢#ff4c00", "ä¸¹#ff4e20", "å½¤#f35336", "é…¡çº¢#dc3023", "ç‚#ff3300", "èŒœè‰²#cb3a56", "ç»¾#a98175",
            "æª€#b36d61", "å«£çº¢#ef7a82", "æ´‹çº¢#ff0097", "æ£çº¢#c32136", "æ®·çº¢#be002f", "èµ«èµ¤#c91f37", "é“¶æœ±#bf242a", "èµ¤#c3272b", "èƒ­è„‚#9d2933", "æ —è‰²#60281e", "ç„è‰²#622a1d",
            "æ¾èŠ±è‰²#bce672", "æŸ³é»„#c9dd22", "å«©ç»¿#bddd22", "æŸ³ç»¿#afdd22", "è‘±é»„#a3d900", "è‘±ç»¿#9ed900", "è±†ç»¿#9ed048", "è±†é’#96ce54", "æ²¹ç»¿#00bc12", "è‘±å€©#0eb83a", "è‘±é’#0eb83a",
            "é’è‘±#0aa344", "çŸ³ç»¿#16a951", "æ¾æŸç»¿#21a675", "æ¾èŠ±ç»¿#057748", "ç»¿æ²ˆ#0c8918", "ç»¿è‰²#00e500", "è‰ç»¿#40de5a", "é’ç¿ #00e079", "é’è‰²#00e09e", "ç¿¡ç¿ è‰²#3de1ad", "ç¢§ç»¿#2add9c",
            "ç‰è‰²#2edfa3", "ç¼¥#7fecad", "è‰¾ç»¿#a4e2c6", "çŸ³é’#7bcfa6", "ç¢§è‰²#1bd1a5", "é’ç¢§#48c0a3", "é“œç»¿#549688", "ç«¹é’#789262", "å¢¨ç°#758a99", "å¢¨è‰²#50616d", "é¸¦é’#424c50", "é»¯#41555d",
            "æ¨±è‰è‰²#eaff56", "é¹…é»„#fff143", "é¸­é»„#faff72", "æé»„#ffa631", "æ©™é»„#ffa400", "æ©™è‰²#fa8c35", "æçº¢#ff8c31", "æ©˜é»„#ff8936", "æ©˜çº¢#ff7500", "è—¤é»„#ffb61e", "å§œé»„#ffc773", "é›Œé»„#ffc64b",
            "èµ¤é‡‘#f2be45", "ç¼ƒè‰²#f0c239", "é›„é»„#e9bb1d", "ç§‹é¦™è‰²#d9b611", "é‡‘è‰²#eacd76", "ç‰™è‰²#eedeb0", "æ¯é»„#d3b17d", "é»„æ Œ#e29c45", "ä¹Œé‡‘#a78e44", "æ˜é»„#c89b40", "æ£•é»„#ae7000", "ç¥ç€#ca6924",
            "æ£•è‰²#b25d25", "èŒ¶è‰²#b35c44", "æ£•çº¢#9b4400", "èµ­#9c5333", "é©¼è‰²#a88462", "ç§‹è‰²#896c39", "æ£•ç»¿#827100", "è¤è‰²#6e511e", "æ£•é»‘#7c4b00", "èµ­è‰²#955539", "èµ­çŸ³#845a33", "ç²¾ç™½#ffffff",
            "é“¶ç™½#e9e7ef", "é“…ç™½#f0f0f4", "éœœè‰²#e9f1f6", "é›ªç™½#f0fcff", "è¹ç™½#e3f9fd", "æœˆç™½#d6ecf0", "è±¡ç‰™ç™½#fffbf0", "ç¼Ÿ#f2ecde", "é±¼è‚šç™½#fcefe8", "ç²‰ç™½#fff2df", "è¼ç™½#f3f9f1", "é¸­åµé’#e0eee8",
            "ç´ #e0f0e9", "é’ç™½#c0ebd7", "èŸ¹å£³é’#bbcdc5", "èŠ±ç™½#c2ccd0", "è€é“¶#bacac6", "ç°è‰²#808080", "è‹è‰²#75878a", "æ°´è‰²#88ada6", "é»#6b6882", "ä¹Œè‰²#725e82", "ç„é’#3d3b4f", "ä¹Œé»‘#392f41", "é»#75664d",
            "é»§#5d513c", "é»é»‘#665757", "ç¼è‰²#493131", "ç…¤é»‘#312520", "æ¼†é»‘#161823", "é»‘è‰²#000000"
        ];
        var colorsJp = ["å¤ä»£ç´«#895b8a", "èŒ„å­ç´º#824880", "äºŒè—#915c8b", "äº¬ç´«#9d5b8b", "è’²è‘¡#7a4171", "è‹¥ç´«#bc64a4", "ç´…ç´«#b44c97", "æ¢…ç´«#aa4c8f", "è–è’²è‰²#cc7eb1", "ç´…è—¤è‰²#cca6bf", "æµ…ç´«#c4a3bf",
            "ç´«æ°´æ™¶#e7e7eb", "è–„æ¢…é¼ #dcd6d9", "æšé¼ #d3cfd9", "ç‰¡ä¸¹é¼ #d3ccd6", "éœè‰²#c8c2c6", "è—¤é¼ #a6a5c4", "åŠè‰²#a69abd", "è–„è‰²#a89dac", "è–„é¼ #9790a4", "é³©ç¾½é¼ #9e8b8e", "é³©ç¾½è‰²#95859c", "æ¡”æ¢—é¼ #95949a",
            "ç´«é¼ #71686c", "è‘¡è„é¼ #705b67", "æ¿ƒè‰²#634950", "ç´«é³¶#5f414b", "æ¿ƒé¼ #4f455c", "è—¤ç…¤ç«¹#5a5359", "æ»…ç´«#594255", "ç´…æ¶ˆé¼ #524748", "ä¼¼ã›ç´«#513743", "ç°é»„ç·‘#e6eae3", "è•éº¦åˆ‡è‰²#d4dcd6", "è–„é›²é¼ #d4dcda",
            "æ¯é‡è‰²#d3cbc6", "æ½¤è‰²#c8c2be", "åˆ©ä¼‘ç™½èŒ¶#b3ada0", "èŒ¶é¼ #a99e93", "èƒ¡æ¡ƒæŸ“#a58f86", "æ±Ÿæˆ¸é¼ #928178", "ç…¤è‰²#887f7a", "ä¸å­èŒ¶#b4866b", "æŸ´æŸ“#b28c6e", "å®—ä¼å”èŒ¶#a16d5d", "ç ºèŒ¶#9f6f55", "ç…èŒ¶è‰²#8c6450",
            "éŠ€ç…¤ç«¹#856859", "é»„æ¯èŒ¶#765c47", "ç…¤ç«¹è‰²#6f514c", "ç„¦èŒ¶#6f4b3e", "é»’æ©¡#544a47", "æ†²æ³•è‰²#543f32", "æ¶…è‰²#554738", "æª³æ¦”å­æŸ“#433d3c", "é»’é³¶#432f2f", "èµ¤å¢¨#3f312b", "é»’ç´…#302833", "ç™½#ffffff", "èƒ¡ç²‰è‰²#fffffc",
            "å¯ã®èŠ±è‰²#f7fcfe", "ç™½ç£#f8fbf8", "ç”Ÿæˆã‚Šè‰²#fbfaf5", "ä¹³ç™½è‰²#f3f3f3", "ç™½ç·´#f3f3f2", "ç´ è‰²#eae5e3", "ç™½æ¢…é¼ #e5e4e6", "ç™½é¼ #dcdddd", "çµ¹é¼ #dddcd6", "ç°é’#c0c6c9", "éŠ€é¼ #afafb0", "è–„éˆ#adadad", "è–„å¢¨è‰²#a3a3a2",
            "éŒ«è‰²#9ea1a3", "ç´ é¼ #9fa0a0", "é¼ è‰²#949495", "æºæ°é¼ #888084", "ç°è‰²#7d7d7d", "é‰›è‰²#7b7c7d", "éˆè‰²#727171", "å¢¨#595857", "ä¸¼é¼ #595455", "æ¶ˆç‚­è‰²#524e4d", "è—å¢¨èŒ¶#474a4d", "ç¾Šç¾¹è‰²#383c3c", "è‹è‰²#2b2b2b", "é»’#2b2b2b",
            "çƒç¾½è‰²#180614", "é‰„é»’#281a14", "æ¿¡ç¾½è‰²#000b00", "é»’å£‡#250d00", "æ†²æ³•é»’èŒ¶#241a08", "æš—é»’è‰²#16160e", "èŒè‘±è‰²#006e54", "èŠ±ç·‘é’#00a381", "ç¿¡ç¿ è‰²#38b48b", "é’ç·‘#00a497", "æ°´æµ…è‘±#80aba9", "éŒ†æµ…è‘±#5c9291", "é’ç¢§#478384",
            "å¾¡å¬èŒ¶#43676b", "æ¹Šé¼ #80989b", "é«˜éº—ç´æˆ¸#2c4f54", "ç™¾å…¥èŒ¶#1f3134", "éŒ†é¼ #47585c", "éŒ†é‰„å¾¡ç´æˆ¸#485859", "è—é¼ #6c848d", "éŒ†å¾¡ç´æˆ¸#53727d", "èˆ›èŠ±è‰²#5b7e91", "ç†¨æ–—ç›®èŠ±è‰²#426579", "å¾¡å¬å¾¡ç´æˆ¸#4c6473", "é‰„å¾¡ç´æˆ¸#455765",
            "ç´ºé¼ #44617b", "è—é‰„#393f4c", "é’è¤#393e4f", "è¤è¿”#203744", "è¤è‰²#4d4c61", "æœˆç™½#eaf4fc", "ç™½è«è‰²#eaedf7", "ç™½èŠ±è‰²#e8ecef", "è—ç™½#ebf6f7", "ç™½è—#c1e4e9", "æ°´è‰²#bce2e8", "ç“¶è¦—#a2d7dd", "ç§˜è‰²è‰²#abced8", "ç©ºè‰²#a0d8ef",
            "å‹¿å¿˜è‰è‰²#89c3eb", "é’è—¤è‰²#84a2d4", "ç™½ç¾¤#83ccd2", "æµ…ç¸¹#84b9cb", "è–„èŠ±è‰²#698aab", "ç´æˆ¸è‰²#008899", "æµ…è‘±è‰²#00a3af", "èŠ±æµ…è‘±#2a83a2", "æ–°æ©‹è‰²#59b9c6", "å¤©è‰²#2ca9e1", "éœ²è‰è‰²#38a1db", "é’#0095d9", "è–„è—#0094c8", "ç¸¹è‰²#2792c3",
            "ç´ºç¢§#007bbb", "è–„ç¾¤é’#5383c3", "è–„èŠ±æ¡œ#5a79ba", "ç¾¤é’è‰²#4c6cb3", "æœè‹¥è‰²#3e62ad", "ç‘ ç’ƒè‰²#1e50a2", "è–„ç¸¹#507ea4", "ç‘ ç’ƒç´º#19448e", "ç´ºç‘ ç’ƒ#164a84", "è—è‰²#165e83", "é’è—#274a78", "æ·±ç¸¹#2a4073", "ç´ºè‰²#223a70", "ç´ºé’#192f60",
            "ç•™ç´º#1c305c", "æ¿ƒè—#0f2350", "é‰„ç´º#17184b", "æ¼†é»’#0d0015", "æ·¡è—¤è‰²#bbc8e6", "è—¤è‰²#bbbcde", "ç´…æ›ç©ºè‰²#8491c3", "ç´…ç¢§#8491c3", "ç´ºæ¡”æ¢—#4d5aaf", "èŠ±è‰²#4d5aaf", "ç´ºè—#4a488e", "ç´…æ¡”æ¢—#4d4398", "æ¡”æ¢—è‰²#5654a2", "è—¤ç´æˆ¸#706caa",
            "ç´…æ›èŠ±è‰²#68699b", "ç´«è‹‘è‰²#867ba9", "ç™½è—¤è‰²#dbd0e6", "è—¤ç´«#a59aca", "è«è‰²#7058a3", "é’ç´«#674598", "è–è’²è‰²#674196", "ç«œèƒ†è‰²#9079ad", "æ±Ÿæˆ¸ç´«#745399", "æœ¬ç´«#65318e", "è‘¡è„è‰²#522f60", "æ·±ç´«#493759", "ç´«é»’#2e2930", "ç´«#884898",
            "è–„è‘¡è„#c0a2c7", "ç´«ç´º#460e44", "æš—ç´…è‰²#74325c", "æ¡‘ã®å®Ÿè‰²#55295b", "é»„é‡‘#e6b422", "æ«¨æŸ“#d9a62e", "é»„æœ½è‘‰è‰²#d3a243", "å±±å¹èŒ¶#c89932", "èŠ¥å­è‰²#d0af4c", "è±†ãŒã‚‰èŒ¶#8b968d", "éº¹å¡µ#6e7955", "å±±é³©è‰²#767c6b", "åˆ©ä¼‘é¼ #888e7e", "æµ·æ¾èŒ¶#5a544b",
            "è—æµ·æ¾èŒ¶#56564b", "è—åªšèŒ¶#56564b", "åƒæ­³èŒ¶#494a41", "å²©äº•èŒ¶#6b6f59", "ä»™æ–èŒ¶#474b42", "é»’ç·‘#333631", "æŸ³ç…¤ç«¹#5b6356", "æ¨ºèŒ¶è‰²#726250", "ç©ºäº”å€å­è‰²#9d896c", "ç”Ÿå£è‰²#94846a", "è‚¥å¾Œç…¤ç«¹#897858", "åªšèŒ¶#716246", "ç™½æ©¡#cbb994", "äºœéº»è‰²#d6c6af",
            "æ¦›è‰²#bfa46f", "ç°æ±è‰²#9e9478", "åˆ©ä¼‘èŒ¶#a59564", "é¶¯èŒ¶#715c1f", "æœ¨è˜­è‰²#c7b370", "ç ‚è‰²#dcd3b2", "æ²¹è‰²#a19361", "åˆ©ä¼‘è‰²#8f8667", "æ¢…å¹¸èŒ¶#887938", "ç’ƒå¯›èŒ¶#6a5d21", "é»„æµ·æ¾èŒ¶#918754", "èœç¨®æ²¹è‰²#a69425", "é’æœ½è‘‰#ada250", "æ ¹å²¸è‰²#938b4b", "é¶¸èŒ¶#8c8861",
            "æŸ³èŒ¶#a1a46d", "æµ·æ¾è‰²#726d40", "é¶¯è‰²#928c36", "ç·‘é»„è‰²#dccb18", "é¶¸è‰²#d7cf3a", "æŠ¹èŒ¶è‰²#c5c56a", "è‹¥è‰è‰²#c3d825", "é»„ç·‘#b8d200", "è‹¥èŠ½è‰²#e0ebaf", "è‹¥èœè‰²#d8e698", "è‹¥è‹—è‰²#c7dc68", "é’ä¸¹#99ab4e", "è‰è‰²#7b8d42", "è‹”è‰²#69821b", "èŒé»„#aacf53", "è‹—è‰²#b0ca71",
            "è‹¥è‘‰è‰²#b9d08b", "æ¾è‘‰è‰²#839b5c", "å¤è™«è‰²#cee4ae", "é¶¸èŒé»„#82ae46", "æŸ³è‰²#a8c97f", "é’ç™½æ©¡#9ba88d", "æŸ³é¼ #c8d5bb", "è£è‘‰æŸ³#c1d8ac", "å±±è‘µè‰²#a8bf93", "è€ç«¹è‰²#769164", "ç™½ç·‘#d6e9ca", "æ·¡èŒé»„#93ca76", "æŸ³æŸ“#93b881", "è–„èŒè‘±#badcad", "æ·±å·é¼ #97a791", "è‹¥ç·‘#98d98e",
            "æµ…ç·‘#88cb7f", "è–„ç·‘#69b076", "é’éˆ#6b7b6e", "é’ç£é¼ #bed2c3", "è–„é’#93b69c", "éŒ†é’ç£#a6c8b2", "ç·‘é’è‰²#47885e", "åƒæ­³ç·‘#316745", "è‹¥ç«¹è‰²#68be8d", "ç·‘#3eb370", "å¸¸ç£è‰²#007b43", "åƒè‰é¼ #bed3ca", "åƒè‰è‰²#92b5a9", "é’ç£è‰²#7ebea5", "é’ç«¹è‰²#7ebeab", "å¸¸ç£ç·‘#028760",
            "æœ¨è³Šè‰²#3b7960", "å¤©éµçµ¨#2f5d50", "è™«è¥–#3a5b52", "é©è‰²#475950", "æ·±ç·‘#00552e", "é‰„è‰²#005243", "å°è±†è‰²#96514d", "æ¯èŒ¶#8d6449", "é¥´è‰²#deb068", "éª†é©¼è‰²#bf794e", "åœŸè‰²#bc763c", "é»„å”è‰²#b98c46", "æ¡‘æŸ“#b79b5b", "æ Œè‰²#b77b57", "é»„æ©¡#b68d4c",
            "ä¸å­—æŸ“#ad7d4c", "é¦™æŸ“#ad7d4c", "æ‡æ·èŒ¶#ae7c4f", "èŠç¿«èŒ¶#ad7e4e", "ç„¦é¦™#ae7c58", "èƒ¡æ¡ƒè‰²#a86f4c", "æ¸‹çº¸è‰²#946243", "æœ½è‘‰è‰²#917347", "æ¡‘èŒ¶#956f29", "è·¯è€ƒèŒ¶#8c7042", "å›½é˜²è‰²#7b6c3e", "ä¼½ç¾…è‰²#d8a373", "æ±Ÿæˆ¸èŒ¶#cd8c5c", "æ¨ºè‰²#cd5e3c", "ç´…é¬±é‡‘#cb8347",
            "åœŸå™¨è‰²#c37854", "ç‹è‰²#c38743", "é»„åœŸè‰²#c39143", "ç¥ç€è‰²#bf783a", "èµ¤èŒ¶#bb5535", "ä»£èµ­#bb5520", "ç…‰ç“¦è‰²#b55233", "é›€èŒ¶#aa4f37", "å›£åéƒèŒ¶#9f563a", "æŸ¿æ¸‹è‰²#9f563a", "ç´…é³¶#9a493f", "ç°èŒ¶#98623c", "èŒ¶è‰²#965042", "æªœçš®è‰²#965036", "é³¶è‰²#95483f", "æŸ¿èŒ¶#954e2a",
            "å¼æŸ„è‰²#8f2e14", "èµ¤éŒ†è‰²#8a3319", "è¤è‰²#8a3b00", "æ —æ¢…#852e19", "ç´…æªœçš®#7b4741", "æµ·è€èŒ¶#773c30", "å”èŒ¶#783c1d", "æ —è‰²#762f07", "èµ¤éŠ…è‰²#752100", "éŒ†è‰²#6c3524", "èµ¤è¤è‰²#683f36", "èŒ¶è¤è‰²#664032", "æ —çš®èŒ¶#6d3c32", "é»’èŒ¶#583822", "è‘¡è„èŒ¶#6c2c2f", "è‘¡è„è‰²#640125",
            "è±è‰è‰²#f8b862", "æŸ‘å­è‰²#f6ad49", "é‡‘èŒ¶#f39800", "èœœæŸ‘è‰²#f08300", "é‰›ä¸¹è‰²#ec6d51", "é»„ä¸¹#ee7948", "æŸ¿è‰²#ed6d3d", "é»„èµ¤#ec6800", "äººå‚è‰²#ec6800", "æ©™è‰²#ee7800", "ç…§æŸ¿#eb6238", "èµ¤æ©™#ea5506", "é‡‘èµ¤#ea5506", "æœ±è‰²#eb6101", "å°éº¦è‰²#e49e61", "ä¸¹è‰²#e45e32", "é»„èŒ¶#e17b34",
            "è‚‰æ¡‚è‰²#dd7a56", "èµ¤æœ½è‘‰è‰²#db8449", "é»„æ«¨æŸ“#d66a35", "è’²å…¬è‹±è‰²#ffd900", "é»„è‰²#ffd900", "ä¸­é»„#ffea00", "èœã®èŠ±è‰²#ffec47", "é»„æª—è‰²#fef263", "åµè‰²#fcd575", "èŠ±è‘‰è‰²#fbd26b", "åˆˆå®‰è‰²#f5e56b", "ç‰èœ€é»è‰²#eec362", "é‡‘ç³¸é›€è‰²#ebd842", "é»„æ”¯å­è‰²#ffdb4f", "æ”¯å­è‰²#fbca4d", "å‘æ—¥è‘µè‰²#fcc800",
            "å±±å¹è‰²#f8b500", "é¬±é‡‘è‰²#fabf14", "è—¤é»„#f7c114", "é‡‘è‰²#e6b422", "è–„æ¡œ#fdeff2", "æ¡œé¼ #e9dfe5", "é¸¨é¼ #e4d2d8", "è™¹è‰²#f6bfbc", "çŠç‘šè‰²#f5b1aa", "ä¸€æ–¤æŸ“#f5b199", "å®è‰²#efab93", "çº¢æ¢…è‰²#f2a0a1", "è–„çº¢#f0908d", "ç”šä¸‰çº¢#ee827c", "æ¡ƒè‰²#f09199", "é¸¨è‰²#f4b3c2", "æ’«å­è‰²#eebbcb", "ç°æ¢…#e8d3c7",
            "ç°æ¡œ#e8d3d1", "æ·¡çº¢è—¤#e6cde3", "çŸ³ç«¹è‰²#e5abbe", "è–„çº¢æ¢…#e597b2", "æ¡ƒèŠ±è‰²#e198b4", "æ°´æŸ¿#e4ab9b", "ã¨ããŒã‚‰èŒ¶#e09e87", "é€€çº¢#d69090", "è–„æŸ¿#d4acad", "é•¿æ˜¥è‰²#c97586", "æ¢…é¼ #c099a0", "é¸¨æµ…è‘±#b88884", "æ¢…æŸ“#b48a76", "è‹èŠ³é¦™#a86965", "æµ…è‹èŠ³#a25768", "çœŸæœ±#ec6d71", "èµ¤ç´«#eb6ea5",
            "èº‘èº…è‰²#e95295", "ç‰¡ä¸¹è‰²#e7609e", "ä»Šæ ·è‰²#d0576b", "ä¸­çº¢#c85179", "è”·è–‡è‰²#e9546b", "éŸ©çº¢#e95464", "é“¶æœ±#c85554", "èµ¤çº¢#c53d43", "çº¢ç·‹#e83929", "èµ¤#e60033", "çŒ©ç·‹#e2041b", "çº¢#d7003a", "æ·±ç·‹#c9171e", "ç»¯è‰²#d3381c", "æ¡œè‰²#bf242a", "èµ¤ä¸¹#ce5242", "çº¢èµ¤#d9333f", "èƒ­è„‚#b94047",
            "æœ±ç·‹#ba2636", "èŒœè‰²#b7282e", "æ·±æµ·è€èŒ¶#a73836", "è‹èŠ³#9e3d3f", "çœŸçº¢#a22041", "æµ“çº¢#a22041", "è±¡ç‰™è‰²#f8f4e6", "ç»ƒè‰²#ede4cd", "ç°ç™½è‰²#e9e4d4", "è’¸æ —è‰²#ede1a9", "å¥³éƒèŠ±#f2f2b0", "æ¯è‰è‰²#e4dc8a", "æ·¡é»„#f8e58c", "ç™½èŒ¶#ddbb99", "èµ¤ç™½æ©¡#d7a98c", "æ´—æŸ¿#f2c9ac", "é¸Ÿã®å­è‰²#fff1cf",
            "èœ‚èœœè‰²#fddea5", "è‚Œè‰²#fce2c4", "è–„åµè‰²#fde8d0", "é›„é»„#f9c89b", "æ´’è½æŸ¿#f7bd8f", "èµ¤é¦™#f6b894", "ç ¥ç²‰è‰²#f4dda5", "è‚‰è‰²#f1bf99", "äººè‰²#f1bf99", "ä¸å­è‰²#efcd9a", "é¦™è‰²#efcd9a", "è–„é¦™#f0cfa0", "æµ…é»„#edd3a1", "æ¯è‰²#e0c38c", "æ·¡é¦™#f3bf88", "æè‰²#f7b977", "ä¸œäº‘è‰²#f19072", "æ›™è‰²#f19072",
            "çŠç‘šæœ±è‰²#ee836f", "æ·±æ”¯å­#eb9b6f", "çº#e0815e", "æµ…ç»¯#df7163", "çœŸèµ­#d57c6b", "æ´—æœ±#d0826c", "é å·èŒ¶#ca8269", "çº¢æ¡¦è‰²#bb5548", "èµ­#ab6953"
        ];
        var g_defaults = {
            size: "5",
            font: 14,
            offsetx: "13",
            offsety: "20",
            colorbg: "#FFFBF0",
            colorfg: "#192F60",
            letters: [
                { t: ' ', sc: 5.25 },
                { t: 'ä¸Šæé‚•', s: 1.5 },
                { t: 'yÅng', x: -1.4, s: 0.75, y: -1.55, c: '#715C1F' },
                { t: '\n', l: 2, sc: 10 },
                { t: 'å” â€¢ æç™½', c: '#008899' }, '\n',
                { t: '\n', l: 1.5, sc: 0 },
                'å¤§é¹ä¸€æ—¥åŒé£èµ·ï¼Œæ‰¶æ‘‡ç›´ä¸Šä¹ä¸‡é‡Œã€‚',
                { t: 'ğŸ¦…', x: -15, y: -1.15 },
                { t: 'ğŸŒªï¸', x: -11, y: -1.15 },
                '\n\n\n',
                'å‡ä»¤é£æ­‡æ—¶ä¸‹æ¥ï¼ŒçŠ¹èƒ½ç°¸å´æ²§æºŸæ°´ã€‚',
                { t: 'bÇ’', x: -5.85, s: 0.75, y: -1, c: '#715C1F' },
                { t: 'ğŸŒŠ', x: -1.9, s: 0.75, y: -1 },
                '\n\n\n',
                'ä¸–äººè§æˆ‘æ’æ®Šè°ƒï¼Œé—»ä½™å¤§è¨€çš†å†·ç¬‘ã€‚',
                { t: 'ğŸ¤£', x: -1.9, s: 0.75, y: -1 },
                '\n\n\n',
                'å®£çˆ¶çŠ¹èƒ½ç•åç”Ÿï¼Œä¸ˆå¤«æœªå¯è½»å¹´å°‘ã€‚',
                { t: 'ğŸ‘', x: -11.85, s: 0.75, y: -1 },
                { t: 'ğŸ¤”', x: -5.85, s: 0.75, y: -1 }
            ]
        };
        var g_colorsTimer = 0;
        /*
        function emojiRegexp() {
            return /\u{1F3F4}(?:\u{E0067}\u{E0062}(?:\u{E0065}\u{E006E}\u{E0067}|\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074})\u{E007F}|\u200D\u2620\uFE0F)|\u{1F469}\u200D\u{1F469}\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F468}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F468}|[\u{1F468}\u{1F469}]\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|[\u{1F3FB}-\u{1F3FF}]\u200D[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|\u{1F469}\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}])|\u{1F469}\u200D\u{1F466}\u200D\u{1F466}|(?:\u{1F441}\uFE0F\u200D\u{1F5E8}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]\u200D[\u2695\u2696\u2708]|\u{1F468}(?:[\u{1F3FB}-\u{1F3FF}]\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|(?:[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}]\uFE0F|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u200D[\u2640\u2642]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9D6}-\u{1F9DD}](?:[\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|\u200D[\u2640\u2642])|\u{1F469}\u200D[\u2695\u2696\u2708])\uFE0F|\u{1F469}\u200D\u{1F467}\u200D[\u{1F466}\u{1F467}]|\u{1F469}\u200D\u{1F469}\u200D[\u{1F466}\u{1F467}]|\u{1F468}(?:\u200D(?:[\u{1F468}\u{1F469}]\u200D[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|[\u{1F3FB}-\u{1F3FF}])|\u{1F3F3}\uFE0F\u200D\u{1F308}|\u{1F469}\u200D\u{1F467}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]\u200D[\u{1F33E}\u{1F373}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9B0}-\u{1F9B3}]|\u{1F469}\u200D\u{1F466}|\u{1F1F6}\u{1F1E6}|\u{1F1FD}\u{1F1F0}|\u{1F1F4}\u{1F1F2}|\u{1F469}[\u{1F3FB}-\u{1F3FF}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|[#\*0-9]\uFE0F\u20E3|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\u{1F3FB}-\u{1F3FF}]|[\u261D\u270A-\u270D\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F470}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F4AA}\u{1F574}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F936}\u{1F9B5}\u{1F9B6}\u{1F9D1}-\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6F9}\u{1F910}-\u{1F93A}\u{1F93C}-\u{1F93E}\u{1F940}-\u{1F945}\u{1F947}-\u{1F970}\u{1F973}-\u{1F976}\u{1F97A}\u{1F97C}-\u{1F9A2}\u{1F9B0}-\u{1F9B9}\u{1F9C0}-\u{1F9C2}\u{1F9D0}-\u{1F9FF}]|[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6F9}\u{1F910}-\u{1F93A}\u{1F93C}-\u{1F93E}\u{1F940}-\u{1F945}\u{1F947}-\u{1F970}\u{1F973}-\u{1F976}\u{1F97A}\u{1F97C}-\u{1F9A2}\u{1F9B0}-\u{1F9B9}\u{1F9C0}-\u{1F9C2}\u{1F9D0}-\u{1F9FF}]\uFE0F|[\u261D\u26F9\u270A-\u270D\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F469}\u{1F46E}\u{1F470}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9D1}-\u{1F9DD}]/gu;
        }

        function emojiCount(s) {
            return (s.match(emojiRegexp()) || []).length + s.replace(emojiRegexp(), '').length;
        } */

        function drawText(context) {
            var color = $id('colorfg').value;
            var offsety = parseFloat($id('offsety').value.replace(/[^\.\d]/, ''));
            var isPercent = true;
            var text = $id('letters').value.trim();
            var font = selectValue($id('font')) || 'monospace';
            var json = {};
            var size = parseInt($id('size').value) * context.canvas.width / 100;
            var ox = context.canvas.width * parseFloat($id('offsetx').value) / 100; // size * parseFloat($id('offsetx').value);
            var x = ox;
            var y = size + context.canvas.height * (!isNaN(offsety) ? (isPercent ? 0.01 : 1) * offsety : 0.5);
            $id('output').innerHTML = '';
            removeClass($id('letters'), 'txa-letter-err');
            try {
                json = eval(text);
                if (!isArray(json)) {
                    return;
                }
                json.forEach(function (j) {
                    if (typeof j === 'string') {
                        j = {
                            t: j
                        };
                    }
                    if (!j.t) {
                        return;
                    }
                    if (/^[\s\n]+$/.test(j.t)) {
                        x = ox + Math.max((j.t.match(/[ ]/g) || []).length, j.sc || 0) * size * (j.s || 1);
                        y += Math.max((j.t.match(/\n/g) || []).length, j.nc || 0) * size * (j.l || 1);
                        return;
                    }
                    var ifont = j.f || font;
                    if (fonts[ifont]) {
                        ifont = fonts[ifont];
                    }
                    ifont = '"' + ifont + '"';
                    context.font = j.font ? j.font : (j.fs ? j.fs + ' ' : '') + (j.s ? (typeof j.s === 'number' ? j.s * size + 'px' : j.s) + ' ' + ifont : (size + 'px ' + ifont));
                    context.textBaseline = j.tbl || '';
                    context.textAlign = j.ta || '';
                    context.fillStyle = j.c || color;
                    context.strokeStyle = j.c || color;
                    context[j.st ? "strokeText" : "fillText"](j.t, typeof j.x !== 'undefined' ? x + size * j.x : x, typeof j.y !== 'undefined' ? y + size * j.y : y);
                    if (typeof j.x === 'undefined') {
                        //x += (emojiCount(j.t) + (j.t.match(emojiRegexp()) || []).length * 0.05) * context.font.match(/\d+/)[0]; // set emoji is 5% wide than other char
                        x += context.measureText(j.t).width; // using measureText to get the text width!
                    }
                    if (typeof j.y !== 'undefined') {
                        //y += parseInt(j.y);
                    }
                });
            } catch (e) {
                $id('output').innerHTML = 'è¯­æ³•é”™è¯¯ï¼š' + (e.message || e);
                toggleClass($id('letters'), 'txa-letter-err', true);
            }
        }

        function setCaches() {
            $q('.txt,.txa,select').forEach(function (e) {
                localStorage.setItem(e.id, /select/i.test(e.tagName) ? e.selectedIndex : e.value);
            });
        }

        function getCaches() {
            $q('.txt,.txa,select').forEach(function (e) {
                var isSelect = /select/i.test(e.tagName);
                var value = localStorage.getItem(e.id) || (e.value || '');
                e[isSelect ? 'selectedIndex' : 'value'] = isSelect ? parseInt(value) : value;
            });
        }

        function selectValue(s) {
            return s.options[s.selectedIndex].value;
        }

        function loadJs(file, callback) {
            var script = document.createElement('script');
            script.src = file;
            script.onload = callback;
            document.head.appendChild(script);
        }

        function saveImage() {
            if (canvas.msToBlob) { //for IE
                var blob = $id('canvas').msToBlob();
                return window.navigator.msSaveBlob(blob, 'letter.png');
            }
            $id('canvas').toBlob(function (blob) {
                saveAs(blob, 'letter.png');
            });
        }

        function idealTextColor(bgColor) {
            var nThreshold = 105;
            var components = getRGBComponents(bgColor);
            var bgDelta = (components.R * 0.299) + (components.G * 0.587) + (components.B * 0.114);
            return ((255 - bgDelta) < nThreshold) ? "#000" : "#fff";
        }

        function getRGBComponents(color) {
            return {
                R: parseInt(color.substring(0, 2), 16),
                G: parseInt(color.substring(2, 4), 16),
                B: parseInt(color.substring(4, 6), 16)
            };
        }

        function clearColorTimer() {
            if (g_colorsTimer) {
                clearTimeout(g_colorsTimer);
                g_colorsTimer = 0;
            }
        }

        function hideColorPan() {
            g_colorsTimer = setTimeout(function () {
                toggleClass($id('colorspan'), 'colors-pan-hide', true);
            }, 200);
        }

        function initColors(context) {
            var cpan = document.createElement('div');
            cpan.id = "colorspan";
            cpan.className = "colors-pan colors-pan-hide";
            cpan.innerHTML = ['å›½é£'].concat(colors, ['æ—¥ç³»'], colorsJp).map(function (c) {
                if (c.indexOf('#') < 0) {
                    return '<h3>' + c + '</h3>';
                }
                var ca = c.split('#');
                var cl = idealTextColor(ca[1]);
                return '<a href="#" style="background:#' + ca[1] + (cl !== '#fff' ? ';color:' + cl : '') + ';" col="' + ca[1].toUpperCase() + '"><i>' + ca[0] + '</i><var>#' + ca[1].toUpperCase() + '</var></a>';
            }).join('');
            $id('aside').appendChild(cpan);
            function showColorPan(input, value) {
                cpan.input = input;
                cpan.value = value || null;
                var val = typeof value !== 'undefined' ? (value ? value.val : '') : input.value.replace('#', ''); // highlight current color 
                if (input.getBoundingClientRect) {
                    var rect = input.getBoundingClientRect();
                    var top = rect.top + rect.height;
                    if (input.nodeName.toLowerCase() === 'textarea') {
                        top = rect.top - 220; // é¢æ¿å‘ä¸ŠğŸ‘†
                    }
                    cpan.style.top = top + 'px';
                    cpan.style.right = '5px';
                } else {
                    cpan.style.bottom = '0px';
                    cpan.style.right = '5px';
                }
                removeClass(cpan, 'colors-pan-hide');
                $q('a.on', cpan).forEach(function (a) { removeClass(a, 'on'); });
                if (val) {
                    try {
                        var col = cpan.querySelector('a[col="' + (val.length === 3 ? val.split('').map(v => v + v).join('') : val).toUpperCase().replace('#', '') + '"]');
                        if (col) {
                            toggleClass(col, 'on', true);
                            if (col.scrollIntoView) col.scrollIntoView(true);
                        }
                    } catch (e) {
                        console.log(e);
                    }
                }
            }

            $q('#colorfg, #colorbg').forEach(function (input) {
                addEvent(input, 'focus', function (evt) {
                    clearColorTimer();
                    if (evt.relatedTarget && evt.relatedTarget.nodeName.toLowerCase() === 'a') return;
                    showColorPan(input);
                });
                addEvent(input, 'blur', function () {
                    hideColorPan();
                });
            });
            function getTextColor(s, start, end) {
                var pre = -1;
                var nxt = -1;
                var val = '';
                var key = '';
                while (start > 0 && !['"', "'", ',', '{', '}'].includes(s.substr(start - 1, 1))) {
                    pre = s.substr(start - 1, 1);
                    start--;
                }
                if (['"', "'"].includes(s.substr(start - 1, 1))) { // å½“å‰ä¸ºå•å¼•å·ã€æˆ–åŒå¼•å·ï¼Œè·³è¿‡ï¼Œç»§ç»­å‘å‰å¯»æ‰¾æ˜¯å¦ä¸º c:èŠ‚ç‚¹
                    pre = start;
                    var p1 = pre - 1;
                    while (p1 > 0 && ![',', '{'].includes(s.substr(p1 - 1, 1))) {
                        key = s.substr(p1 - 1, 1) + key;
                        p1--;
                    }
                }

                while (start < s.length && !['"', "'", ',', '{', '}'].includes(s.substr(start, 1))) {
                    val += s.substr(start, 1);
                    start++;
                }
                if (['"', "'"].includes(s.substr(start, 1))) {
                    nxt = start;
                }
                return /\s*c\s*:\s*/.test(key) && pre > 0 && nxt > 0 && !/['"]/.test(val) ? { start: pre, end: nxt, val: val } : null;
            }
            addEvent($id('letters'), 'click keydown', function (evt) {
                setTimeout(function () {
                    var pos = getCursorPos($id('letters'));
                    if (pos) {
                        var value = getTextColor($id('letters').value, pos.start, pos.end); // è·å–å‰å20ä¸ªå­—ç¬¦ã€‚
                        if (value) {
                            showColorPan($id('letters'), value);
                        } else {
                            hideColorPan();
                        }
                    }
                }, 0);
            });
            addEvent($id('letters'), 'blur', function () {
                hideColorPan();
            });
            addEvents($q('.colors-pan a'), 'click', function (evt) {
                clearColorTimer();
                evt.preventDefault();
                evt.stopPropagation();
                $q('a.on', cpan).forEach(function (a) { removeClass(a, 'on'); });
                toggleClass(this, 'on', true);
                var val = this.querySelector('var').innerHTML;
                cpan.input.focus();
                if (cpan.value) {
                    if (cpan.input.setSelectionRange) cpan.input.setSelectionRange(cpan.value.start, cpan.value.end);
                    if (cpan.input.setRangeText) {
                        cpan.input.setRangeText(val, cpan.value.start, cpan.value.end);
                        cpan.value.end = cpan.value.start + val.length;
                    }
                } else {
                    cpan.input.value = val;
                }
                setCaches();
                preview(context);
                return false;
            });
        }

        function getCursorPos(input) {
            if ("selectionStart" in input && document.activeElement == input) {
                return { start: input.selectionStart, end: input.selectionEnd };
            } else if (input.createTextRange) {
                var sel = document.selection.createRange();
                if (sel.parentElement() === input) {
                    var rng = input.createTextRange();
                    rng.moveToBookmark(sel.getBookmark());
                    for (var len = 0; rng.compareEndPoints("EndToStart", rng) > 0; rng.moveEnd("character", -1)) {
                        len++;
                    }
                    rng.setEndPoint("StartToStart", input.createTextRange());
                    for (var pos = { start: 0, end: len }; rng.compareEndPoints("EndToStart", rng) > 0; rng.moveEnd("character", -1)) {
                        pos.start++;
                        pos.end++;
                    }
                    return pos;
                }
            }
            return null;
        }

        window.onload = function () {
            var urlparam = location.href.split('?').slice(1).join('');
            if (urlparam) {
                var pms = urlparam.split('&').reduce(function (succ, a) {
                    var aa = a.split('=');
                    if (aa.length === 2) succ[aa[0]] = b64SafeDecode(aa[1]);
                    return succ;
                }, {});
                if ('localStorage' in window && 'JSON' in window && JSON.parse && (pms.l || pms.p)) { // å­˜åœ¨å‚æ•°ï¼Œè®¾ç½®ç¼“å­˜ï¼Œç„¶åè·³è½¬ã€‚
                    if (pms.l) {
                        localStorage.setItem('letters', pms.l);
                    }
                    try {
                        var pj = JSON.parse(pms.p);
                        if (pj) {
                            for (let k in pj) {
                                localStorage.setItem(k, pj[k]);
                            }
                        }
                    } catch (e) {
                        alert('å¤„ç†å…¨å±€å‚æ•°é”™è¯¯');
                    }
                }
                location.href = location.href.split('?')[0];
            }
            var context = $id('canvas').getContext('2d');
            for (var k in fonts) {
                var option = document.createElement('option');
                option.value = k;
                option.innerHTML = k;
                $id('font').appendChild(option);
            }
            getCaches();
            preview(context);
            addEvent($id('rotate'), 'click', function () {
                if (context.image) {
                    if (typeof context.image.rotate === 'undefined') context.image.rotate = 0;
                    context.image.rotate += 90;
                    if (context.image.rotate >= 360) {
                        context.image.rotate -= 360;
                    }
                    preview(context);
                }
            });
            addEvent($id('file'), 'change', function (event) {
                readFile(event.target.files, context);
            });
            dropEvent($id('dropIn'), function (files) {
                readFile(files, context);
            });
            addEvent($id('letters'), 'input', function (event) {
                setCaches();
                preview(context);
            });
            addEvents($q('.txt'), 'input', function (event) {
                setCaches();
                preview(context);
            });
            addEvents($q('select'), 'change', function (event) {
                setCaches();
                preview(context);
            });
            addEvent($id('download'), 'click', function (event) {
                event.stopPropagation();
                event.preventDefault();
                if (this.innerHTML !== '') {
                    if (!'Blob' in window) {
                        alert("Your browser doesn't support download");
                        return;
                    }
                    if (!window.saveAs) {
                        loadJs('FileSaver.min.js', function () {
                            saveImage();
                        });
                    } else {
                        saveImage();
                    }
                }
            });
            addEvent($id('showmsg-close'), 'click', function (event) {
                removeClass($id('showmsg'), 'showmsg-show');
            });
            addEvent($id('share'), 'click', function (event) {
                var valLetters = $id('letters').value.replace(/(^[\s\t\n]+)|([\s\t\n]+$)/g, '');
                if (!valLetters) {
                    return showMsg('è¯·å…ˆè¾“å…¥æ–‡å­—', 3000);
                } else if (!('JSON' in window) || !JSON.stringify) {
                    return showMsg('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒåˆ†äº«åŠŸèƒ½', 3000);
                }
                var params = JSON.stringify($q('.txt,select').reduce(function (succ, e) {
                    var isSelect = /select/i.test(e.tagName);
                    succ[e.id] = isSelect ? e.selectedIndex : e.value;
                    return succ;
                }, {}));
                var link = location.href.split('?')[0] + '?l=' + b64SafeEncode(valLetters) + '&p=' + b64SafeEncode(params);
                if (link.length > 8000) {
                    return showMsg('åˆ†äº«è¿æ¥é•¿åº¦è¶…è¿‡8000ï¼ŒURLå¯èƒ½ä¼šè¢«æˆªæ–­ï¼Œè¯·ç¼©å‡å†…å®¹', 3000);;
                }
                showMsg('<textarea class="txa txa-in-msg" id="txa-in-msg">' + link + '</textarea>');
                if ($id('txa-in-msg').select) {
                    $id('txa-in-msg').select();
                    var succeeded = false;
                    try {
                        succeeded = document.execCommand("Copy");
                    } catch (err) {
                        succeeded = false;
                    }
                    if (succeeded) {
                        var ndiv = document.createElement('div');
                        ndiv.className = 'showmsg-tip';
                        ndiv.innerHTML = 'å·²ç»æˆåŠŸå¤åˆ¶åˆ°å‰ªåˆ‡æ¿';
                        $id('showmsg-in').appendChild(ndiv);
                    }
                }
            });
            addEvent($id('menu'), 'click', function (event) {
                if ($id('menu').running) {
                    return;
                }
                $id('menu').running = true;
                toggleClass($id('menu'), 'menu-on');
                var isHide = $id('aside').className.match(/aside-hide/);
                if (isHide) {
                    removeClass($id('aside'), 'aside-hide');
                    setTimeout(function () {
                        $id('aside').style.right = 0;
                        setTimeout(function () {
                            $id('menu').running = false;
                        }, 500);
                    }, 0);
                } else {
                    $id('aside').style.right = -($id('aside').clientWidth + 100) + 'px';
                    setTimeout(function () {
                        toggleClass($id('aside'), 'aside-hide', true);
                        $id('menu').running = false;
                    }, 500);
                }
            });
            addEvent($id('notebtn'), 'click', function (event) {
                toggleClass($id('note'), 'note-hide');
            });
            addEvent(window, 'resize', function (event) {
                preview(context);
            });
            if (!localStorage.getItem('visited')) {
                localStorage.setItem('visited', 'yes');
                removeClass($id('note'), 'note-hide');
                setTimeout(function () { toggleClass($id('note'), 'note-hide', true); }, 3000);
            }
            initColors(context);
            if ('JSON' in window && JSON.stringify && Object.keys(g_defaults).every(k => !localStorage.getItem(k))) {
                for (var k in g_defaults) {
                    var node = $id(k).nodeName.toLowerCase();
                    if ('select' === node) {
                        $id(k).selectedIndex = g_defaults[k];
                    } else if ('textarea' === node) {
                        $id(k).value = JSON.stringify(g_defaults[k]);
                    } else {
                        $id(k).value = g_defaults[k];
                    }
                }
                preview(context);
            }
        };
    </script>
</body>

</html>